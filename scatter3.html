
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Proof of Concept, Proven Value</title>
<script src="d3.v7.min.js"></script>
<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:16px;background:#f5f5f5;color:#333;font-size:13px}
h1{text-align:center;margin:0 0 12px;font-size:1.2rem}
#dashboard{display:flex;gap:14px;justify-content:center;flex-wrap:wrap}
#left,#right{display:flex;flex-direction:column;gap:12px}
#center{display:flex;flex-direction:column;align-items:center;gap:12px}
.card{background:#fff;border:1px solid #ddd;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1);padding:10px 14px;min-width:150px;text-align:center}
.card h3{margin:0 0 4px;font-size:.78rem;color:#555}
.card span{font-size:1.15rem;font-weight:600}
.sub{display:flex;gap:6px;justify-content:center;margin-top:4px}
.sub div{background:#f0f3f8;border-radius:6px;padding:4px 6px;min-width:65px}
.sub h4{margin:0;font-size:.55rem;font-weight:600;color:#555}
.sub span{font-size:.7rem;font-weight:600}
#ctrl{display:flex;gap:12px;align-items:center;background:#fff;border:1px solid #ddd;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1);padding:6px 14px;font-size:.7rem}
input[type=range]{-webkit-appearance:none;width:150px;height:4px;background:#d0d0d0;border-radius:3px}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:13px;height:13px;border-radius:50%;background:#616161;border:2px solid #fff;cursor:pointer}
button{background:#616161;color:#fff;border:none;border-radius:6px;padding:4px 12px;font-size:.73rem;cursor:pointer}
button:hover{background:#424242}
svg#chart{background:linear-gradient(160deg,#e9f4ff 0%,#ffffff 70%);border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
@keyframes pulseG{0%{r:14;opacity:.8}50%{r:26;opacity:0}100%{r:14;opacity:.8}}
@keyframes pulseR{0%{r:14;opacity:.45}50%{r:26;opacity:0}100%{r:14;opacity:.45}}
</style>
</head>
<body>
<h1>Proof of Concept, Proven Value</h1>

<div id="dashboard">
  <!-- left -->
  <div id="left">
    <div class="card"><h3>Combined Approval</h3><span id="acc">0%</span>
      <div class="sub"><div><h4>Bank</h4><span id="accB">0%</span></div></div></div>
    <div class="card"><h3>Combined Default</h3><span id="def">0%</span>
      <div class="sub"><div><h4>Bank</h4><span id="defB">0%</span></div></div></div>
  </div>

  <!-- centre -->
  <div id="center">
    <svg id="chart" width="540" height="420"></svg>
    <div id="ctrl">
      <label><strong>Score ≥</strong> <span id="th">1</span></label>
      <input id="slider" type="range" min="1" max="10" step="1" value="1">
      <button id="play">Play</button>
    </div>
  </div>

  <!-- right -->
  <div id="right">
    <div class="card"><h3>Peso Benefit</h3>
      <div class="sub">
        <div><h4>Net / Loan</h4><span id="net">₱0</span></div>
        <div><h4>Default<br>Savings</h4><span id="save">₱0</span></div>
      </div></div>
    <div class="card"><h3>Thin-File Gains</h3>
      <span id="gain" style="font-weight:600;color:#22ff55">0</span><br>
      <span id="loss" style="font-weight:600;color:#ff1744">0</span>
      <button id="halo">Highlight</button></div>
    <div class="card"><h3>ROI Curve</h3><div id="roi"></div></div>
  </div>
</div>

<script>
/* ---------- config ---------- */
const CSV="data.csv",REV=2500,LGD=6500,AVG=75000,R=10,FADE=.25,BASE=.70;
const svg=d3.select("#chart"),W=+svg.attr("width"),H=+svg.attr("height"),
      M={top:38,right:40,bottom:60,left:80},
      x=d3.scaleLinear().domain([1,10]).range([M.left+R,W-M.right-R]),
      y=d3.scaleLinear().domain([1,10]).range([M.top+R,H-M.bottom-R]),
      col=d3.scaleThreshold().domain([.11,.20,.32,.42,.50])
          .range(["#9CCC65","#D4E157","#FFEE58","#FFCA28","#FFA726","#FF7043"]);

d3.csv(CSV,d3.autoType).then(raw=>{
  const clean=raw.filter(r=>!Object.values(r).some(v=>v==="#N/A"||v===null)).map(d=>({
      tel:d["FinScore Telco"],bank:d["Bank Internal Score"],comb:d["Combined Score"],bad:d["Good/Bad Flag"]}));
  const total=clean.length/BASE,
        st=f=>{const s=clean.filter(f);return{acc:s.length/total,pd:d3.mean(s,d=>d.bad)||0}};

  const bankBase=st(d=>d.bank<=10),bankDef=bankBase.pd*bankBase.acc;

  svg.append("g").attr("transform",`translate(0,${H-M.bottom})`).call(d3.axisBottom(x).ticks(10));
  svg.append("g").attr("transform",`translate(${M.left},0)`).call(d3.axisLeft(y).ticks(10).tickFormat(d=>11-d));
  svg.append("text").attr("class","axis").attr("x",W/2).attr("y",H-M.bottom+45).attr("text-anchor","middle").text("FinScore Telco");
  svg.append("text").attr("class","axis").attr("transform","rotate(-90)").attr("x",-H/2).attr("y",M.left-60).attr("text-anchor","middle").text("Bank Score");

  const dots=svg.append("g").selectAll("circle").data(clean).join("circle")
      .attr("cx",d=>x(d.tel)).attr("cy",d=>y(d.bank)).attr("r",R).attr("fill",d=>col(d.bad)).attr("stroke","#333").attr("stroke-width",.4);
  const labels=svg.append("g").selectAll("text").data(clean).join("text")
      .attr("x",d=>x(d.tel)).attr("y",d=>y(d.bank)).attr("dy",".35em").attr("text-anchor","middle")
      .attr("font-size",".56rem").attr("font-weight","600").text(d=>d3.format(".0%")(d.bad));

  const tip=d3.select("body").append("div").style("position","absolute").style("pointer-events","none")
      .style("background:#fff").style("border","1px solid #ccc").style("padding","4px 6px").style("border-radius","6px").style("font-size:.65rem").style("opacity",0);
  dots.on("mouseover",(e,d)=>tip.style("opacity",1).html(`T:${d.tel} B:${d.bank}<br>Pd:${(d.bad*100).toFixed(1)}%`))
      .on("mousemove",(e)=>tip.style("left",(e.pageX+9)+"px").style("top",(e.pageY-26)+"px"))
      .on("mouseout",()=>tip.style("opacity",0));

  const cut=svg.append("line").attr("x1",M.left).attr("x2",W-M.right).attr("stroke","#000").attr("stroke-dasharray","4 4");

  /* ROI */
  const roi=d3.range(1,11).map(t=>{const s=st(d=>d.comb>=t);return{t,net:(REV-(s.pd*LGD))*s.acc}}),
        rx=d3.scaleLinear().domain([1,10]).range([0,120]),ry=d3.scaleLinear().domain([0,d3.max(roi,d=>d.net)]).range([80,0]),
        rSvg=d3.select("#roi").append("svg").attr("width",140).attr("height",90);
  rSvg.append("path").datum(roi).attr("fill","none").attr("stroke","#1976d2").attr("stroke-width",1.4)
      .attr("d",d3.line().x(d=>rx(d.t)).y(d=>ry(d.net)));
  rSvg.append("circle").attr("id","curr").attr("r",3).attr("fill","#d32f2f");

  /* DOM refs */
  const sl=d3.select("#slider"),th=d3.select("#th"),acc=d3.select("#acc"),def=d3.select("#def"),
        accB=d3.select("#accB"),defB=d3.select("#defB"),net=d3.select("#net"),sav=d3.select("#save"),
        gain=d3.select("#gain"),loss=d3.select("#loss"),haloBtn=d3.select("#halo");
  const halosG=svg.append("g"),halosR=svg.append("g"); let haloOn=false;

  function halos(t){
    const keep=d=>d.comb>=t, bank=d=>d.bank<=11-t,
          g=clean.filter(d=>d.bank>=8&&d.tel>=6&&keep(d)&&!bank(d)),
          r=clean.filter(d=>bank(d)&&!keep(d));
    halosG.selectAll("circle").data(haloOn?g:[]).join("circle")
        .attr("cx",d=>x(d.tel)).attr("cy",d=>y(d.bank)).attr("r",14).attr("fill","none")
        .attr("stroke","#22ff55").attr("stroke-width",2.5).style("animation","pulseG 1.4s ease-out infinite");
    halosR.selectAll("circle").data(haloOn?r:[]).join("circle")
        .attr("cx",d=>x(d.tel)).attr("cy",d=>y(d.bank)).attr("r",14).attr("fill","none")
        .attr("stroke","#ff1744").attr("stroke-width",1.6).style("animation","pulseR 1.4s ease-out infinite");
  }

  function upd(t){
    th.text(t);
    const keep=d=>d.comb>=t, bank=d=>d.bank<=11-t, sC=st(keep), sB=st(bank);
    acc.text((sC.acc*100).toFixed(1)+"%"); def.text((sC.pd*100).toFixed(1)+"%");
    accB.text((sB.acc*100).toFixed(1)+"%"); defB.text((sB.pd*100).toFixed(1)+"%");
    net.text("₱"+(REV-(sC.pd*LGD)).toFixed(0));
    sav.text("₱"+((bankDef-sC.pd*sC.acc)*AVG).toFixed(0));
    gain.text(clean.filter(d=>d.bank>=8&&d.tel>=6&&keep(d)&&!bank(d)).length);
    loss.text(clean.filter(d=>bank(d)&&!keep(d)).length);
    dots.attr("opacity",d=>keep(d)?1:FADE);
    labels.attr("opacity",d=>keep(d)?1:FADE);
    rSvg.select("#curr").attr("cx",rx(t)).attr("cy",ry((REV-(sC.pd*LGD))*sC.acc));
    cut.attr("y1",y(11-t)).attr("y2",y(11-t));
    halos(t);
  }

  sl.on("input",e=>upd(+e.target.value));
  upd(1);

  /* play */
  let tm=null;
  d3.select("#play").on("click",function(){
    if(tm){clearInterval(tm);tm=null;this.textContent="Play";return;}
    this.textContent="Pause";
    tm=setInterval(()=>{let v=+sl.node().value;v=v<10?v+1:1;sl.node().value=v;upd(v)},1600);
  });

  haloBtn.on("click",function(){haloOn=!haloOn;haloBtn.classed("active",haloOn);haloBtn.text(haloOn?"Hide":"Highlight");upd(+sl.node().value)});
});
</script>
</body>
</html>

























