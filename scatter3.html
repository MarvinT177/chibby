
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Proof of Concept, Proven Value</title>
<script src="d3.v7.min.js"></script>
<style>
/* ---------- SAME CSS AS LAST VERSION ---------- */
:root{
  --card-grad:#b2d1e7;        /* gradient light blue */
  --btn-main:#376e96;         /* button normal */
  --btn-hover:#1d5a86;        /* button hover  */
  --shadow-sm:0 2px 4px rgba(0,0,0,.08);
  --thin-green:#22ff55;
  --inverse-red:#ff1744;
}

/* card depth */
.metric-box{
  background:linear-gradient(180deg,#ffffff 0%,var(--card-grad) 100%);
  border:1px solid rgba(0,0,0,.06);
  border-radius:8px;
  box-shadow:0 6px 14px rgba(0,0,0,.12);
  padding:6px 10px;
  text-align:center;
  min-width:140px;
}

/* buttons (Play / Hide-Highlight) */
button{
  background:var(--btn-main);
  color:#fff;border:none;border-radius:6px;
  padding:3px 10px;font-size:.7rem;cursor:pointer;box-shadow:var(--shadow-sm);
}
button:hover{background:var(--btn-hover)}
/* thin-file button when active keeps its green state */
#thin-toggle.active{background:var(--thin-green);color:#000}

/* slider thumb colour tweaks */
input[type=range]::-webkit-slider-thumb,
input[type=range]::-moz-range-thumb{
  background:var(--btn-main);
}
</style>
</head>
<body>
<h1>Proof of Concept, Proven Value</h1>

<div id="dashboard">
  <!-- LEFT -->
  <div id="left-col">
    <div class="metric-box"><h3>Combined Approval</h3><span id="acc-rate">0%</span>
      <div class="sub-metrics"><div class="sub-box"><h4>Bank</h4><span id="acc-bank">0%</span></div></div></div>
    <div class="metric-box"><h3>Combined Default</h3><span id="def-rate">0%</span>
      <div class="sub-metrics"><div class="sub-box"><h4>Bank</h4><span id="def-bank">0%</span></div></div></div>
  </div>

  <!-- CENTER -->
  <div id="center-col">
    <svg id="scatter" width="540" height="420"></svg>
    <div id="controls">
      <label><strong>Score ≥</strong> <span id="thresh-val">1</span></label>
      <input id="threshold" type="range" min="1" max="10" step="1" value="1">
      <button id="toggle">Play</button>
    </div>
  </div>

  <!-- RIGHT -->
  <div id="right-col">
    <div class="metric-box"><h3>Peso Benefit</h3>
      <div class="sub-metrics" style="gap:5px">
        <div class="sub-box"><h4>Net / Loan</h4><span id="benefit-loan">₱0</span></div>
        <div class="sub-box"><h4>Default<br>Savings</h4><span id="benefit-save">₱0</span></div>
      </div></div>

    <div class="metric-box"><h3>Thin-File Gains</h3>
      <div id="thin-wrap">
        <span id="thin-count"   class="num-pill thin-num">0</span>
        <span id="inverse-count"class="num-pill inverse-num">0</span>
      </div>
      <button id="thin-toggle">Highlight</button></div>

    <div id="roi-box"><h3>ROI Curve</h3><div id="roi-chart"></div></div>
  </div>
</div>

<script>
const REV=2500,LGD=6500,AVG_LOAN=75000,CSV="data.csv",RAD=10,FADE=.25,BASE=.70;
const svg=d3.select("#scatter"),W=+svg.attr("width"),H=+svg.attr("height"),
      M={top:38,right:40,bottom:60,left:80},
      x=d3.scaleLinear().domain([1,10]).range([M.left+RAD,W-M.right-RAD]),
      y=d3.scaleLinear().domain([1,10]).range([M.top+RAD,H-M.bottom-RAD]),
      colour=d3.scaleThreshold().domain([.11,.20,.32,.42,.50])
             .range(["#9CCC65","#D4E157","#FFEE58","#FFCA28","#FFA726","#FF7043"]);

d3.csv(CSV,d3.autoType).then(raw=>{
  const rows=raw.filter(r=>!Object.values(r).some(v=>v==="#N/A"||v===null));
  const data=d3.rollups(rows,
      v=>({telco:+v[0]["FinScore Telco"],bank:+v[0]["Bank Internal Score"],comb:+v[0]["Combined Score"],
           bad:d3.mean(v,d=>d["Good/Bad Flag"]),n:v.length}),
      d=>`${d["FinScore Telco"]}-${d["Bank Internal Score"]}-${d["Combined Score"]}`).map(d=>d[1]);

  const totalApps=d3.sum(data,d=>d.n)/BASE,
        stats=f=>{const s=data.filter(f),n=d3.sum(s,d=>d.n);return{acc:n/totalApps,pd:n?d3.sum(s,d=>d.n*d.bad)/n:0}},
        bankBase=stats(d=>d.bank<=10);

  /* axes */
  svg.append("g").attr("transform",`translate(0,${H-M.bottom})`).call(d3.axisBottom(x).ticks(10));
  svg.append("g").attr("transform",`translate(${M.left},0)`).call(d3.axisLeft(y).ticks(10).tickFormat(d=>11-d));

  svg.append("text").attr("x",W/2).attr("y",H-M.bottom+42).attr("text-anchor","middle").attr("font-size",".8rem").attr("font-weight","bold")
      .text("FinScore Telco Score");
  svg.append("text").attr("x",-H/2).attr("y",M.left-60).attr("transform","rotate(-90)").attr("text-anchor","middle")
      .attr("font-size",".8rem").attr("font-weight","bold").text("Bank Internal Score");

  /* points */
  const g=svg.append("g");
  g.selectAll("circle").data(data).join("circle")
    .attr("cx",d=>x(d.telco)).attr("cy",d=>y(d.bank)).attr("r",RAD).attr("fill",d=>colour(d.bad)).attr("stroke","#333").attr("stroke-width",.4);
  g.selectAll("text").data(data).join("text")
    .attr("x",d=>x(d.telco)).attr("y",d=>y(d.bank)).attr("dy",".35em").attr("text-anchor","middle")
    .attr("font-size",".58rem").attr("font-weight","600").text(d=>d3.format(".0%")(d.bad));

  /* tooltip */
  const tip=d3.select("body").append("div").style("position","absolute").style("pointer-events","none")
      .style("background","#fff").style("border","1px solid #ccc").style("padding","4px 7px").style("border-radius","6px")
      .style("box-shadow","0 2px 6px rgba(0,0,0,.08)").style("font-size",".65rem").style("opacity",0);
  g.selectAll("circle")
    .on("mouseover",(e,d)=>tip.style("opacity",1).html(`T:${d.telco} B:${d.bank}<br>Pd:${(d.bad*100).toFixed(1)}% N:${d.n}`))
    .on("mousemove",e=>tip.style("left",(e.pageX+10)+"px").style("top",(e.pageY-28)+"px"))
    .on("mouseout",()=>tip.style("opacity",0));

  const cut=svg.append("line").attr("x1",M.left).attr("x2",W-M.right).attr("stroke","#000").attr("stroke-dasharray","4 4");
  const roi=d3.range(1,11).map(t=>{const s=stats(d=>d.comb>=t);return{t,net:(REV-(s.pd*LGD))*s.acc}}),
        rx=d3.scaleLinear().domain([1,10]).range([0,120]),ry=d3.scaleLinear().domain([0,d3.max(roi,d=>d.net)]).range([80,0]);
  const rSvg=d3.select("#roi-chart").append("svg").attr("width",140).attr("height",90);
  rSvg.append("path").datum(roi).attr("fill","none").attr("stroke","#1976d2").attr("stroke-width",1.4)
      .attr("d",d3.line().x(d=>rx(d.t)).y(d=>ry(d.net)));
  rSvg.append("circle").attr("id","roi-cur").attr("r",3).attr("fill","#d32f2f");

  /* DOM refs */
  const S=d3.select("#threshold"),TH=d3.select("#thresh-val"),
        ACC=d3.select("#acc-rate"),DEF=d3.select("#def-rate"),ACCB=d3.select("#acc-bank"),DEFB=d3.select("#def-bank"),
        NET=d3.select("#benefit-loan"),SAVE=d3.select("#benefit-save"),
        GAIN=d3.select("#thin-count"),LOSS=d3.select("#inverse-count"),
        haloBtn=d3.select("#thin-toggle"),halosG=svg.append("g"),halosR=svg.append("g"); let haloOn=false;

  function renderHalos(t){
    const keep=d=>d.comb>=t, bank=d=>d.bank<=11-t;
    halosG.selectAll("circle").data(haloOn?data.filter(d=>d.bank>=8&&d.telco>=6&&keep(d)&&!bank(d)):[]).join("circle")
      .attr("cx",d=>x(d.telco)).attr("cy",d=>y(d.bank)).attr("r",14).attr("fill","none")
      .attr("stroke","var(--thin-green)").attr("stroke-width",2.5).style("animation","pulseG 1.4s ease-out infinite");
    halosR.selectAll("circle").data(haloOn?data.filter(d=>bank(d)&&!keep(d)):[]).join("circle")
      .attr("cx",d=>x(d.telco)).attr("cy",d=>y(d.bank)).attr("r",14).attr("fill","none")
      .attr("stroke","var(--inverse-red)").attr("stroke-width",1.6).style("animation","pulseR 1.4s ease-out infinite");
  }

  /* ---------- UPDATE (GAIN/LOSS now sum applicant counts) ---------- */
  function update(t){
    TH.text(t);
    const keep=d=>d.comb>=t, bank=d=>d.bank<=11-t, sC=stats(keep), sB=stats(bank);
    ACC.text((sC.acc*100).toFixed(1)+"%"); DEF.text((sC.pd*100).toFixed(1)+"%");
    ACCB.text((sB.acc*100).toFixed(1)+"%"); DEFB.text((sB.pd*100).toFixed(1)+"%");
    NET.text("₱"+(REV-(sC.pd*LGD)).toFixed(0));
    SAVE.text("₱"+((bankBase.pd*bankBase.acc - sC.pd*sC.acc)*AVG_LOAN).toFixed(0));

    /* NEW: applicant totals */
    GAIN.text(d3.sum(data.filter(d=>d.bank>=8&&d.telco>=6&&keep(d)&&!bank(d)),d=>d.n));
    LOSS.text(d3.sum(data.filter(d=>bank(d)&&!keep(d)),d=>d.n));

    g.selectAll("circle").attr("opacity",d=>keep(d)?1:FADE);
    g.selectAll("text").attr("opacity",d=>keep(d)?1:FADE);
    rSvg.select("#roi-cur").attr("cx",rx(t)).attr("cy",ry((REV-(sC.pd*LGD))*sC.acc));
    cut.attr("y1",y(11-t)).attr("y2",y(11-t));
    renderHalos(t);
  }

  S.on("input",e=>update(+e.target.value));
  update(1);

  let timer=null;
  d3.select("#toggle").on("click",function(){
    if(timer){clearInterval(timer);timer=null;this.textContent="Play";return;}
    this.textContent="Pause";
    timer=setInterval(()=>{let v=+S.node().value;v=v<10?v+1:1;S.node().value=v;update(v)},1600);
  });

  haloBtn.on("click",function(){
    haloOn=!haloOn;haloBtn.classed("active",haloOn).text(haloOn?"Hide":"Highlight");update(+S.node().value);
  });
});
</script>
</body>
</html>



























